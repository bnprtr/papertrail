name: changelog-fragment

on:
  pull_request:
    types: [opened, synchronize, reopened, edited, labeled, unlabeled]
    # Docs-only changes can use workflow-level filtering instead of tool config.
    paths-ignore:
      - "docs/**"
      - "README.md"
      - "AGENTS.md"
      - "CHANGELOG.md"

permissions:
  contents: read

jobs:
  require-fragment:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - uses: actions/setup-go@v5
        with:
          go-version-file: go.mod
          cache: true
      - name: Require + validate changelog fragment
        shell: bash
        run: |
          set -euo pipefail
          git fetch origin "${{ github.base_ref }}" --depth=1
          go run ./cmd/papertrail pr-fragment \
            --base-ref "origin/${{ github.base_ref }}" \
            --fragments changelog.d \
            --manifest .papertrail.config.yml

